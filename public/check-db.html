<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ•°æ®åº“æ£€æŸ¥ - BranchWrite</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 20px;
      line-height: 1.6;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: #252526;
      border-radius: 8px;
      padding: 30px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    }
    
    h1 {
      color: #4ec9b0;
      margin-bottom: 20px;
      font-size: 24px;
    }
    
    h2 {
      color: #569cd6;
      margin: 20px 0 10px;
      font-size: 18px;
    }
    
    .section {
      background: #1e1e1e;
      padding: 15px;
      border-radius: 4px;
      margin-bottom: 15px;
      border-left: 3px solid #007acc;
    }
    
    .item {
      margin-bottom: 15px;
      padding: 10px;
      background: #2d2d30;
      border-radius: 4px;
    }
    
    .key {
      color: #9cdcfe;
      font-weight: bold;
    }
    
    .value {
      color: #ce9178;
      margin-left: 10px;
    }
    
    .number {
      color: #b5cea8;
    }
    
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    
    .stat-card {
      background: #2d2d30;
      padding: 15px;
      border-radius: 4px;
      text-align: center;
    }
    
    .stat-value {
      font-size: 32px;
      font-weight: bold;
      color: #4ec9b0;
      margin: 10px 0;
    }
    
    .stat-label {
      color: #858585;
      font-size: 14px;
    }
    
    button {
      background: #0e639c;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin-right: 10px;
      margin-bottom: 10px;
    }
    
    button:hover {
      background: #1177bb;
    }
    
    button.danger {
      background: #c5302f;
    }
    
    button.danger:hover {
      background: #e81123;
    }
    
    pre {
      background: #1e1e1e;
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 12px;
    }
    
    .empty {
      color: #858585;
      font-style: italic;
      text-align: center;
      padding: 40px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ” BranchWrite æ•°æ®åº“æ£€æŸ¥</h1>
    
    <div style="margin-bottom: 20px;">
      <button onclick="checkDatabase()">ğŸ”„ åˆ·æ–°æ•°æ®</button>
      <button onclick="exportData()">ğŸ“¥ å¯¼å‡ºæ•°æ®</button>
      <button class="danger" onclick="clearData()">ğŸ—‘ï¸ æ¸…ç©ºæ•°æ®</button>
    </div>
    
    <div id="output"></div>
  </div>

  <script>
    function checkDatabase() {
      const output = document.getElementById('output');
      output.innerHTML = '';
      
      const keys = Object.keys(localStorage);
      const branchwriteKeys = keys.filter(k => k.startsWith('branchwrite_'));
      
      if (branchwriteKeys.length === 0) {
        output.innerHTML = '<div class="empty">âŒ æ²¡æœ‰æ‰¾åˆ°ä»»ä½•æ•°æ®</div>';
        return;
      }
      
      // ç»Ÿè®¡ä¿¡æ¯
      const stats = getStatistics();
      output.innerHTML += `
        <h2>ğŸ“Š æ•°æ®ç»Ÿè®¡</h2>
        <div class="stats">
          <div class="stat-card">
            <div class="stat-label">ä¹¦ç±æ•°é‡</div>
            <div class="stat-value">${stats.totalBooks}</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">æ–‡æ¡£æ•°é‡</div>
            <div class="stat-value">${stats.totalDocs}</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">æ€»å­—æ•°</div>
            <div class="stat-value">${stats.totalWords.toLocaleString()}</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">å­˜å‚¨ä½¿ç”¨</div>
            <div class="stat-value">${stats.storageUsed}</div>
          </div>
        </div>
      `;
      
      // ä¹¦ç±åˆ—è¡¨
      const projectsData = localStorage.getItem('branchwrite_projects');
      if (projectsData) {
        const projects = JSON.parse(projectsData);
        
        output.innerHTML += '<h2>ğŸ“š ä¹¦ç±åˆ—è¡¨</h2>';
        
        projects.forEach((project, index) => {
          const docsKey = `branchwrite_documents_${project.id}`;
          const docsData = localStorage.getItem(docsKey);
          const docs = docsData ? JSON.parse(docsData) : [];
          
          let html = `
            <div class="section">
              <div class="item">
                <div><span class="key">${index + 1}. ${project.name}</span></div>
                <div style="margin-left: 20px; margin-top: 10px; color: #858585;">
                  <div>ID: ${project.id}</div>
                  <div>ä½œè€…: ${project.author || 'æœªçŸ¥'}</div>
                  <div>æè¿°: ${project.description || 'æ— '}</div>
                  <div>åˆ›å»º: ${new Date(project.created_at).toLocaleString('zh-CN')}</div>
                  <div>ä¿®æ”¹: ${new Date(project.last_modified).toLocaleString('zh-CN')}</div>
                </div>
              </div>
          `;
          
          if (docs.length > 0) {
            html += '<div style="margin-left: 20px;">';
            html += '<div style="color: #569cd6; margin: 10px 0;">ğŸ“„ æ–‡æ¡£åˆ—è¡¨:</div>';
            docs.forEach((doc, docIndex) => {
              const contentKey = `branchwrite_content_${project.id}_${doc.id}`;
              const content = localStorage.getItem(contentKey) || '';
              
              html += `
                <div class="item" style="margin-bottom: 10px;">
                  <div><span class="key">${docIndex + 1}. ${doc.title}</span></div>
                  <div style="margin-left: 20px; margin-top: 5px; color: #858585; font-size: 12px;">
                    <div>ç±»å‹: ${doc.type} | çŠ¶æ€: ${doc.status}</div>
                    <div>å­—æ•°: ${doc.word_count || 0} | å­—ç¬¦: ${doc.character_count || 0}</div>
                    <div>å†…å®¹é•¿åº¦: ${content.length} å­—ç¬¦</div>
                    <div>åˆ›å»º: ${new Date(doc.created_at).toLocaleString('zh-CN')}</div>
                  </div>
                  ${content ? `<pre style="margin-top: 10px;">${content.substring(0, 200)}${content.length > 200 ? '...' : ''}</pre>` : ''}
                </div>
              `;
            });
            html += '</div>';
          } else {
            html += '<div style="margin-left: 20px; color: #858585; font-style: italic;">æš‚æ— æ–‡æ¡£</div>';
          }
          
          html += '</div>';
          output.innerHTML += html;
        });
      }
      
      // åŸå§‹æ•°æ®
      output.innerHTML += '<h2>ğŸ”‘ æ‰€æœ‰å­˜å‚¨é”®</h2>';
      output.innerHTML += '<div class="section">';
      branchwriteKeys.forEach(key => {
        const value = localStorage.getItem(key);
        const size = ((key.length + (value?.length || 0)) * 2 / 1024).toFixed(2);
        output.innerHTML += `<div class="item"><span class="key">${key}</span> <span class="value">(${size} KB)</span></div>`;
      });
      output.innerHTML += '</div>';
    }
    
    function getStatistics() {
      const projectsData = localStorage.getItem('branchwrite_projects');
      const projects = projectsData ? JSON.parse(projectsData) : [];
      
      let totalDocs = 0;
      let totalWords = 0;
      let totalChars = 0;
      let totalSize = 0;
      
      projects.forEach(project => {
        const docsKey = `branchwrite_documents_${project.id}`;
        const docsData = localStorage.getItem(docsKey);
        if (docsData) {
          const docs = JSON.parse(docsData);
          totalDocs += docs.length;
          docs.forEach(doc => {
            totalWords += doc.word_count || 0;
            totalChars += doc.character_count || 0;
          });
        }
      });
      
      Object.keys(localStorage).forEach(key => {
        if (key.startsWith('branchwrite_')) {
          const value = localStorage.getItem(key);
          totalSize += (key.length + (value?.length || 0)) * 2;
        }
      });
      
      return {
        totalBooks: projects.length,
        totalDocs,
        totalWords,
        totalChars,
        storageUsed: (totalSize / 1024).toFixed(2) + ' KB'
      };
    }
    
    function exportData() {
      const data = {};
      Object.keys(localStorage).forEach(key => {
        if (key.startsWith('branchwrite_')) {
          data[key] = localStorage.getItem(key);
        }
      });
      
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `branchwrite-backup-${Date.now()}.json`;
      a.click();
      URL.revokeObjectURL(url);
      
      alert('âœ… æ•°æ®å·²å¯¼å‡º');
    }
    
    function clearData() {
      if (!confirm('âš ï¸ ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼')) {
        return;
      }
      
      if (!confirm('âš ï¸âš ï¸ å†æ¬¡ç¡®è®¤ï¼šè¿™å°†åˆ é™¤æ‰€æœ‰ä¹¦ç±å’Œæ–‡æ¡£ï¼')) {
        return;
      }
      
      Object.keys(localStorage).forEach(key => {
        if (key.startsWith('branchwrite_')) {
          localStorage.removeItem(key);
        }
      });
      
      alert('âœ… æ•°æ®å·²æ¸…ç©º');
      checkDatabase();
    }
    
    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
    checkDatabase();
  </script>
</body>
</html>
